import type { PieceType } from './constants';

type Position = [number, number];

interface PieceDefinition {
  rotations: Position[][];
  color: number;
}

const PIECE_DEFINITIONS: Record<PieceType, PieceDefinition> = {
  I: {
    rotations: [
      [[0, 0], [-1, 0], [1, 0], [2, 0]],
      [[0, 0], [0, -1], [0, 1], [0, 2]],
      [[-1, 0], [0, 0], [1, 0], [2, 0]],
      [[0, -1], [0, 0], [0, 1], [0, 2]],
    ],
    color: 1,
  },
  O: {
    rotations: [
      [[0, 0], [1, 0], [0, 1], [1, 1]],
      [[0, 0], [1, 0], [0, 1], [1, 1]],
      [[0, 0], [1, 0], [0, 1], [1, 1]],
      [[0, 0], [1, 0], [0, 1], [1, 1]],
    ],
    color: 2,
  },
  T: {
    rotations: [
      [[0, 0], [-1, 0], [1, 0], [0, 1]],
      [[0, 0], [0, -1], [0, 1], [1, 0]],
      [[0, 0], [-1, 0], [1, 0], [0, -1]],
      [[0, 0], [0, -1], [0, 1], [-1, 0]],
    ],
    color: 3,
  },
  S: {
    rotations: [
      [[0, 0], [1, 0], [0, 1], [-1, 1]],
      [[0, 0], [0, -1], [1, 0], [1, 1]],
      [[0, 0], [-1, 0], [0, -1], [1, -1]],
      [[0, 0], [0, -1], [-1, 0], [-1, 1]],
    ],
    color: 4,
  },
  Z: {
    rotations: [
      [[0, 0], [-1, 0], [0, 1], [1, 1]],
      [[0, 0], [0, -1], [1, 0], [1, -1]],
      [[0, 0], [1, 0], [0, -1], [-1, -1]],
      [[0, 0], [0, -1], [-1, 0], [-1, 1]],
    ],
    color: 5,
  },
  J: {
    rotations: [
      [[0, 0], [-1, 0], [1, 0], [-1, 1]],
      [[0, 0], [0, -1], [0, 1], [1, 1]],
      [[0, 0], [-1, 0], [1, 0], [1, -1]],
      [[0, 0], [0, -1], [0, 1], [-1, -1]],
    ],
    color: 6,
  },
  L: {
    rotations: [
      [[0, 0], [-1, 0], [1, 0], [1, 1]],
      [[0, 0], [0, -1], [0, 1], [1, -1]],
      [[0, 0], [-1, 0], [1, 0], [-1, -1]],
      [[0, 0], [0, -1], [0, 1], [-1, 1]],
    ],
    color: 7,
  },
};

export function getPieceCells(type: PieceType, rotation: number): Position[] {
  return PIECE_DEFINITIONS[type].rotations[rotation % 4];
}

export function getPieceColor(type: PieceType): number {
  return PIECE_DEFINITIONS[type].color;
}

interface KickTable {
  [key: string]: Position[];
}

const KICK_TABLE_JLSTZ: KickTable = {
  '0->1': [[0, 0], [-1, 0], [-1, 1], [0, -2], [-1, -2]],
  '1->0': [[0, 0], [1, 0], [1, -1], [0, 2], [1, 2]],
  '1->2': [[0, 0], [1, 0], [1, -1], [0, 2], [1, 2]],
  '2->1': [[0, 0], [-1, 0], [-1, 1], [0, -2], [-1, -2]],
  '2->3': [[0, 0], [1, 0], [1, 1], [0, -2], [1, -2]],
  '3->2': [[0, 0], [-1, 0], [-1, -1], [0, 2], [-1, 2]],
  '3->0': [[0, 0], [-1, 0], [-1, -1], [0, 2], [-1, 2]],
  '0->3': [[0, 0], [1, 0], [1, 1], [0, -2], [1, -2]],
};

const KICK_TABLE_I: KickTable = {
  '0->1': [[0, 0], [-2, 0], [1, 0], [-2, -1], [1, 2]],
  '1->0': [[0, 0], [2, 0], [-1, 0], [2, 1], [-1, -2]],
  '1->2': [[0, 0], [-1, 0], [2, 0], [-1, 2], [2, -1]],
  '2->1': [[0, 0], [1, 0], [-2, 0], [1, -2], [-2, 1]],
  '2->3': [[0, 0], [2, 0], [-1, 0], [2, 1], [-1, -2]],
  '3->2': [[0, 0], [-2, 0], [1, 0], [-2, -1], [1, 2]],
  '3->0': [[0, 0], [1, 0], [-2, 0], [1, -2], [-2, 1]],
  '0->3': [[0, 0], [-1, 0], [2, 0], [-1, 2], [2, -1]],
};

export function getWallKicks(type: PieceType, fromRotation: number, toRotation: number): Position[] {
  if (type === 'O') {
    return [[0, 0]];
  }
  
  const key = `${fromRotation}->${toRotation}`;
  
  if (type === 'I') {
    return KICK_TABLE_I[key] || [[0, 0]];
  }
  
  return KICK_TABLE_JLSTZ[key] || [[0, 0]];
}
